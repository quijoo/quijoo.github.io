<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>计算机组成原理 中央处理器 - Quijo&#39;s blog</title><meta name="Description" content=""><meta property="og:title" content="计算机组成原理 中央处理器" />
<meta property="og:description" content="中央处理器(Central Processing Unit，简称CPU) CPU 功能和基本结构 CPU 功能 指令控制（取指，分析，执行） 操作控制一条指令执行，需要控制的各个门电" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://blog.xuaii.cc/ji-suan-ji-zu-cheng-yuan-li-zhong-yang-chu-li-qi/" /><meta property="og:image" content="http://blog.xuaii.cc/logo.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-03T18:27:39+08:00" />
<meta property="article:modified_time" content="2023-09-05T21:03:06+08:00" /><meta property="og:site_name" content="我的网站" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://blog.xuaii.cc/logo.png"/>

<meta name="twitter:title" content="计算机组成原理 中央处理器"/>
<meta name="twitter:description" content="中央处理器(Central Processing Unit，简称CPU) CPU 功能和基本结构 CPU 功能 指令控制（取指，分析，执行） 操作控制一条指令执行，需要控制的各个门电"/>
<meta name="application-name" content="我的网站">
<meta name="apple-mobile-web-app-title" content="我的网站"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="http://blog.xuaii.cc/ji-suan-ji-zu-cheng-yuan-li-zhong-yang-chu-li-qi/" /><link rel="prev" href="http://blog.xuaii.cc/ji-suan-ji-zhi-ling-xi-tong/" /><link rel="next" href="http://blog.xuaii.cc/neural-network/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "计算机组成原理 中央处理器",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/blog.xuaii.cc\/ji-suan-ji-zu-cheng-yuan-li-zhong-yang-chu-li-qi\/"
        },"genre": "posts","wordcount":  7669 ,
        "url": "http:\/\/blog.xuaii.cc\/ji-suan-ji-zu-cheng-yuan-li-zhong-yang-chu-li-qi\/","datePublished": "2023-01-03T18:27:39+08:00","dateModified": "2023-09-05T21:03:06+08:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "_quijo"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Quijo&#39;s blog">Quijolient</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/record/"> 记录 </a><a class="menu-item" href="/focus/"> 关注 </a><a class="menu-item" href="/about/"> 关于 </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Quijo&#39;s blog">Quijolient</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/record/" title="">记录</a><a class="menu-item" href="/focus/" title="">关注</a><a class="menu-item" href="/about/" title="">关于</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">计算机组成原理 中央处理器</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="blog.xuii.cc" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>_quijo</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2023-01-03">2023-01-03</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;7669 words&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;16 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="true">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#cpu-功能和基本结构">CPU 功能和基本结构</a>
      <ul>
        <li><a href="#cpu-功能">CPU 功能</a></li>
        <li><a href="#结构">结构</a></li>
      </ul>
    </li>
    <li><a href="#指令执行过程">指令执行过程</a>
      <ul>
        <li><a href="#1-指令周期">1. 指令周期</a></li>
        <li><a href="#2-指令周期的数据流">2. 指令周期的数据流</a></li>
        <li><a href="#3-指令执行方案">3. 指令执行方案</a></li>
      </ul>
    </li>
    <li><a href="#数据通路的功能和基本结构">数据通路的功能和基本结构</a>
      <ul>
        <li><a href="#1-数据通路功能">1. 数据通路功能</a></li>
        <li><a href="#2-数据通路结构">2. 数据通路结构</a></li>
      </ul>
    </li>
    <li><a href="#控制器">控制器</a>
      <ul>
        <li><a href="#硬布线控制器">硬布线控制器</a></li>
        <li><a href="#微程序控制器">微程序控制器</a></li>
      </ul>
    </li>
    <li><a href="#异常和中断机制">异常和中断机制</a>
      <ul>
        <li><a href="#概念">概念</a></li>
        <li><a href="#分类">分类</a></li>
        <li><a href="#响应">响应</a></li>
      </ul>
    </li>
    <li><a href="#指令流水线">*指令流水线</a>
      <ul>
        <li><a href="#1-基本概念">1. 基本概念</a></li>
        <li><a href="#2-流水线冒险">2. 流水线冒险</a></li>
        <li><a href="#3-性能指标">3. 性能指标</a></li>
        <li><a href="#4-高级流水线技术">4. 高级流水线技术</a></li>
      </ul>
    </li>
    <li><a href="#多处理器基本概念">多处理器基本概念</a>
      <ul>
        <li><a href="#sisdsimdmimd">SISD、SIMD、MIMD</a></li>
        <li><a href="#硬件多线程">硬件多线程</a></li>
        <li><a href="#多核处理器">多核处理器</a></li>
        <li><a href="#共享内存多处理器">共享内存多处理器</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>中央处理器(Central Processing Unit，简称CPU)</p>
<h2 id="cpu-功能和基本结构">CPU 功能和基本结构</h2>
<h3 id="cpu-功能">CPU 功能</h3>
<p><strong>指令控制</strong>（取指，分析，执行）</p>
<p><strong>操作控制</strong>一条指令执行，需要控制的各个门电路信号</p>
<p><strong>时间控制</strong> 系统时钟</p>
<p><strong>数据加工</strong> 算术逻辑运算</p>
<p><strong>中断处理</strong> 异常和特殊请求的处理</p>
<h3 id="结构">结构</h3>
<p><strong>运算器</strong></p>
<p>算术逻辑单元，暂存寄存器，累加寄存器，通用寄存器组，程序状态字寄存器</p>
<p><strong>控制器</strong></p>
<p>程序计数器，指令寄存器，指令译码器，存储器地址寄存器，存储器数据寄存器</p>
<h2 id="指令执行过程">指令执行过程</h2>
<h3 id="1-指令周期">1. 指令周期</h3>
<p><strong>取指周期</strong>： 从内存中读取指令</p>
<p>间址周期：取一次和多次间址</p>
<p>执行周期：</p>
<p>中断周期：每条指令执行完成后查询中断请求，如果有中断请求则进入中断周期</p>
<p>为了区别不同周期，使用标志触发器 FE, IND, EX, INT 表示各个周期，取 1 为有效值</p>
<h3 id="2-指令周期的数据流">2. 指令周期的数据流</h3>
<p>取指周期</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="n">PC</span> <span class="p">-&gt;</span> <span class="n">MAR</span> <span class="p">-&gt;</span> <span class="err">地址总线</span> <span class="p">-&gt;</span> <span class="err">主存</span>
</span></span><span class="line"><span class="cl"><span class="n">CU</span><span class="err">读命令</span> <span class="p">-&gt;</span> <span class="err">控制总线</span> <span class="p">-&gt;</span> <span class="err">主存</span>
</span></span><span class="line"><span class="cl"><span class="err">主存</span> <span class="p">-&gt;</span> <span class="err">数据总线</span> <span class="p">-&gt;</span> <span class="n">MDR</span> <span class="p">-&gt;</span> <span class="n">IR</span>
</span></span><span class="line"><span class="cl"><span class="n">CU</span><span class="err">控制信号</span> <span class="p">-&gt;</span> <span class="n">PC</span><span class="p">+</span><span class="m">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>间地周期</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="n">Ad</span><span class="p">(</span><span class="n">IR</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">MAR</span> <span class="p">-&gt;</span> <span class="err">地址总线</span> <span class="p">-&gt;</span> <span class="err">主存</span>
</span></span><span class="line"><span class="cl"><span class="n">CU</span> <span class="err">读命令</span> <span class="p">-&gt;</span> <span class="err">控制总线</span> <span class="p">-&gt;</span> <span class="err">主存</span>
</span></span><span class="line"><span class="cl"><span class="err">主存</span> <span class="p">-&gt;</span> <span class="err">数据总线</span> <span class="p">-&gt;</span><span class="n">MDR</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>中断周期</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="n">CU</span><span class="err">控制</span><span class="n">SP</span><span class="p">-</span><span class="m">1</span><span class="err">，</span> <span class="n">SP</span><span class="p">-&gt;</span><span class="n">MAR</span><span class="p">-&gt;</span><span class="err">地址总线</span><span class="p">-&gt;</span><span class="err">主存</span>
</span></span><span class="line"><span class="cl"><span class="n">CU</span><span class="err">写命令</span><span class="p">-&gt;</span><span class="err">控制总线</span><span class="p">-&gt;</span><span class="err">主存</span>
</span></span><span class="line"><span class="cl"><span class="n">PC</span><span class="p">-&gt;</span><span class="n">MDR</span><span class="p">-&gt;</span><span class="err">数据总线</span><span class="p">-&gt;</span><span class="err">主存（存入断点）</span>
</span></span><span class="line"><span class="cl"><span class="n">CU</span><span class="err">（中断服务程序入口）</span> <span class="p">-&gt;</span> <span class="n">PC</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="3-指令执行方案">3. 指令执行方案</h3>
<p>单周期：每条指令时钟周期数固定</p>
<p>多周期：每条指令使用不同周期数，但是指令只能一条执行完才能执行下一条</p>
<p>流水线：流水（参考MIPS 五级流水）</p>
<h2 id="数据通路的功能和基本结构">数据通路的功能和基本结构</h2>
<h3 id="1-数据通路功能">1. 数据通路功能</h3>
<p>描述信息从什么地方开始，中间经过了哪些寄存器和开关，传送到哪个寄存器</p>
<h3 id="2-数据通路结构">2. 数据通路结构</h3>
<ul>
<li>
<p>CPU内单总线方式：所有东西通过公共同通路传输，冲突概率较高，性能低</p>
</li>
<li>
<p>CPU内三总线方式：提高效率，数据总线，地址总线，控制总线</p>
</li>
<li>
<p>专用数据通路方式：需要传送数据的地方直接安排连线，性能高，硬件量大</p>
</li>
</ul>
<p><strong>寄存器间数据传送</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="n">PC</span> <span class="p">-&gt;</span> <span class="n">Bus</span>
</span></span><span class="line"><span class="cl"><span class="n">Bus</span> <span class="p">-&gt;</span> <span class="n">MAR</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>主存 &amp; CPU 信息传送</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="n">PC</span> <span class="p">-&gt;</span> <span class="n">Bus</span> <span class="p">-&gt;</span> <span class="n">MAR</span>
</span></span><span class="line"><span class="cl"><span class="m">1</span> <span class="p">-&gt;</span> <span class="n">R</span>
</span></span><span class="line"><span class="cl"><span class="n">MEM</span><span class="p">(</span><span class="n">MAR</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">MDR</span>
</span></span><span class="line"><span class="cl"><span class="n">MDR</span> <span class="p">-&gt;</span> <span class="n">Bus</span> <span class="p">-&gt;</span> <span class="n">IR</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>执行算术逻辑运算</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="n">Ad</span><span class="p">(</span><span class="n">IR</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Bus</span> <span class="p">-&gt;</span> <span class="n">MAR</span>
</span></span><span class="line"><span class="cl"><span class="m">1</span> <span class="p">-&gt;</span> <span class="n">R</span>
</span></span><span class="line"><span class="cl"><span class="n">MEM</span><span class="p">-&gt;</span><span class="err">数据线</span><span class="p">-&gt;</span><span class="n">MDR</span>
</span></span><span class="line"><span class="cl"><span class="n">MDR</span> <span class="p">-&gt;</span> <span class="n">Bus</span> <span class="p">-&gt;</span><span class="n">Y</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="n">ACC</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="n">Y</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Z</span>
</span></span><span class="line"><span class="cl"><span class="n">Z</span> <span class="p">-&gt;</span> <span class="n">ACC</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="控制器">控制器</h2>
<p>计算机的五大功能部件</p>
<ul>
<li>
<p>控制器部件</p>
</li>
<li>
<p>运算器部件</p>
</li>
<li>
<p>输入设备 / 输出设备</p>
</li>
<li>
<p>内存储器</p>
</li>
</ul>
<p>他们之间通过 <strong>数据总线</strong>、<strong>地址总线</strong>、<strong>控制总线</strong> 相互通信，其中输入输出设备是通过<strong>接口电路</strong>连接的</p>
<ol>
<li>
<p>控制器部件从数据总线接受指令</p>
</li>
<li>
<p>从运算器不见接受<strong>指令转移</strong>地址</p>
</li>
<li>
<p>送出 <strong>指令地址</strong> 到 <strong>地址总线</strong></p>
</li>
<li>
<p>向系统中的部件提供运行所需的<strong>控制信号</strong></p>
</li>
</ol>
<hr>
<p><strong>控制器的主要功能：</strong></p>
<ul>
<li>
<p><strong>取指令</strong>和指出<strong>下一条指令的地址</strong></p>
</li>
<li>
<p>对指令进行<strong>译码</strong> 和 <strong>测试</strong>，以产生相应操作的<strong>控制信号</strong></p>
</li>
<li>
<p>指挥并控制 CPU、主存、输入输出设备之间的<strong>数据流动方向</strong></p>
</li>
</ul>
<p>根据控制器产生微操作控制信号的方式不同，分为<strong>硬布线控制器</strong> 和 <strong>微程序控制器</strong>， 其中 PC 和 IR 是相同的，但是确定和表示<strong>指令执行步骤</strong>的办法和需要的<strong>控制信号</strong>是不同的</p>
<h3 id="硬布线控制器">硬布线控制器</h3>
<p>根据指令要求、当前时序、外部和内部状态，按时间顺序发送一系列<strong>微操作控制信号</strong>（也叫做组合逻辑控制器）。</p>
<p>区别于微程序控制器使用的微指令，<strong>硬布线控制器</strong>是直接采用组合逻辑电路实现<strong>机器指令</strong>，以 “<em>使用最少零部件，去的最高速度</em>” 作为设计目标，优点是<strong>速度快</strong>（电路延迟），缺点是<strong>不易添加新的功能</strong></p>
<ol>
<li>
<p>硬布线控制单元图</p>
<p>硬布线控制单元，从 CU 中分离出 <strong>操作码译码器</strong>， <strong>节拍发生器</strong>，其中操作译码器将 N 位操作码翻译为 $2^N$ 位， 再输入 CU。</p>
<p><strong>节拍发生器</strong> 产生的节拍(T1, T2, T3, &hellip;) 由 <strong>机器主频</strong>(CLK) 分频得到，CU 使用 <strong>操作码</strong>， <strong>节拍信号</strong>， <strong>状态标志</strong> 在不同的节拍输出不同的控制信号（微操作命令 $C_i$）</p>
<p><strong>使用节拍的原因</strong> 首先信号发出到稳定需要一个极短的时间间隔，所以 CPU 需要有一个最短时间（类似于我们的普朗克时间），其次，一个 <strong>机器指令</strong>，需要由多个微操作来完成，微操作按照<strong>一定的顺序</strong>生效，所以需要<strong>节拍</strong> 来区分微操作顺序 例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-markdown" data-lang="markdown"><span class="line"><span class="cl">操作A -&gt; 操作B -&gt; 操作C
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">out = T1 <span class="ge">* A + T2 *</span> B + T3 * C
</span></span></code></pre></td></tr></table>
</div>
</div><p>按节拍顺序执行操作，总之技巧是<strong>通过逻辑组合控制各个开关,结合节拍器控制顺序（详见4）</strong></p>
</li>
<li>
<p>硬布线控制器的<strong>时序系统</strong>和<strong>微操作</strong></p>
<ul>
<li>
<p>时钟周期：时钟信号控制的节拍发生器，每个节拍的宽度正好是时钟周期，每个节拍内可以<strong>完成一个/几个需要同时完成的操作</strong></p>
</li>
<li>
<p>机器周期：所有指令执行的<strong>基准时间</strong>（完成一个基本操作需要的时间），通常取存取周期作为基准时间，在存储字长等于指令字长时，存取周期 = 机器周期</p>
<p>一个机器周期内，完成若干微操作，通过时钟信号控制产生每个微操作</p>
</li>
<li>
<p>指令周期：取出并执行一条指令的时间</p>
</li>
<li>
<p>微操作命令分析：指令分为三个周期 <strong>取值周期</strong>-&gt;<strong>间址周期</strong>-&gt;<strong>执行周期</strong></p>
<p><strong>取址</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">PC</span>       <span class="o">-&gt;</span>     <span class="n">MAR</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>        <span class="o">-&gt;</span>     <span class="n">R</span>
</span></span><span class="line"><span class="cl"><span class="n">M</span><span class="p">(</span><span class="n">MAR</span><span class="p">)</span>   <span class="o">-&gt;</span>     <span class="n">MDR</span>
</span></span><span class="line"><span class="cl"><span class="n">MDR</span>      <span class="o">-&gt;</span>     <span class="n">IR</span>
</span></span><span class="line"><span class="cl"><span class="n">OP</span><span class="p">(</span><span class="n">IR</span><span class="p">)</span>   <span class="o">-&gt;</span>     <span class="n">CU</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="n">PC</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-&gt;</span>     <span class="n">PC</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>间址周期</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">Ad</span><span class="p">(</span><span class="n">IR</span><span class="p">)</span>   <span class="o">-&gt;</span>    <span class="n">MAR</span>
</span></span><span class="line"><span class="cl"><span class="mi">1</span>        <span class="o">-&gt;</span>    <span class="n">R</span>
</span></span><span class="line"><span class="cl"><span class="n">M</span><span class="p">(</span><span class="n">MAR</span><span class="p">)</span>   <span class="o">-&gt;</span>    <span class="n">MDR</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>执行周期</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c#" data-lang="c#"><span class="line"><span class="cl"><span class="n">a</span><span class="p">.</span> <span class="err">非访存指令</span>
</span></span><span class="line"><span class="cl"><span class="n">CLA</span>    <span class="c1">// 清ACC</span>
</span></span><span class="line"><span class="cl"><span class="n">COM</span>    <span class="c1">// 取反</span>
</span></span><span class="line"><span class="cl"><span class="n">SHR</span>    <span class="c1">// 算术右移</span>
</span></span><span class="line"><span class="cl"><span class="n">CSL</span>    <span class="c1">// 循环左移</span>
</span></span><span class="line"><span class="cl"><span class="n">STOP</span>   <span class="c1">// 停机指令</span>
</span></span><span class="line"><span class="cl"><span class="n">b</span><span class="p">.</span> <span class="err">访存指令</span>
</span></span><span class="line"><span class="cl"><span class="n">ADD</span> <span class="n">X</span>  <span class="c1">// 加法指令</span>
</span></span><span class="line"><span class="cl"><span class="n">Ad</span><span class="p">(</span><span class="n">IR</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">MAR</span><span class="p">,</span> <span class="m">1</span> <span class="p">-&gt;</span> <span class="n">R</span>
</span></span><span class="line"><span class="cl"><span class="n">M</span><span class="p">(</span><span class="n">MAR</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">MDR</span>
</span></span><span class="line"><span class="cl"><span class="p">(</span><span class="n">ACC</span><span class="p">)</span> <span class="p">+</span> <span class="p">(</span><span class="n">MDR</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">ACC</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">STA</span> <span class="n">X</span>  <span class="c1">// 存数指令</span>
</span></span><span class="line"><span class="cl"><span class="n">Ad</span><span class="p">(</span><span class="n">IR</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">MAR</span><span class="p">,</span> <span class="m">1</span> <span class="p">-&gt;</span> <span class="n">W</span>
</span></span><span class="line"><span class="cl"><span class="n">ACC</span> <span class="p">-&gt;</span> <span class="n">MDR</span>
</span></span><span class="line"><span class="cl"><span class="n">MDR</span> <span class="p">-&gt;</span> <span class="n">M</span><span class="p">(</span><span class="n">MAR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">LDA</span> <span class="n">X</span>  <span class="c1">// 取数指令</span>
</span></span><span class="line"><span class="cl"><span class="n">Ad</span><span class="p">(</span><span class="n">IR</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">MAR</span><span class="p">,</span> <span class="m">1</span> <span class="p">-&gt;</span> <span class="n">R</span>
</span></span><span class="line"><span class="cl"><span class="n">M</span><span class="p">(</span><span class="n">MAR</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">MDR</span>
</span></span><span class="line"><span class="cl"><span class="n">MDR</span> <span class="p">-&gt;</span> <span class="n">ACC</span>
</span></span><span class="line"><span class="cl"><span class="n">c</span><span class="p">.</span> <span class="err">转移指令</span>
</span></span><span class="line"><span class="cl"><span class="n">JMP</span> <span class="n">X</span>     <span class="p">=&gt;</span>    <span class="n">Ad</span><span class="p">(</span><span class="n">IR</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">PC</span>
</span></span><span class="line"><span class="cl"><span class="n">BAN</span> <span class="n">X</span>     <span class="p">=&gt;</span>    <span class="n">A0</span> <span class="p">*</span> <span class="n">Ad</span><span class="p">(</span><span class="n">IR</span><span class="p">)</span> <span class="p">+</span> <span class="p">(~</span><span class="n">A0</span><span class="p">)</span> <span class="p">*</span> <span class="p">(</span><span class="n">PC</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">PC</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p>CPU 控制方式</p>
<p>控制一条指令本质是依次执行一个确定的<strong>微操作序列</strong>， 不同指令对应的微操作<strong>数量</strong>和<strong>复杂度</strong>不一样,因此每条指令执行时间不相同，使用以下三种方法控制：</p>
<p><strong>同步控制</strong></p>
<p>所有控制信号都来自统一系统时钟，一<strong>最长</strong>微操作和<strong>最繁琐</strong>微操作为标准，采取<strong>统一</strong>、<strong>相同时间间隔</strong>、<strong>相同节拍数</strong> 作为机器周期来运行不同指令</p>
<p>特点：简单，速度慢（因为短命令也需要经过长周期）</p>
<p><strong>异步控制</strong></p>
<p>不存在 <em>基准信号</em>，各个部件按照自身固有速度工作，通过异步应答方式交流</p>
<p>特点：快速，控制复杂</p>
<p><strong>联合控制</strong></p>
<p>介于同步和异步之间，对不同的指令的微操作实行<strong>大部分采用同步控制</strong>，<strong>小部分采用异步控制</strong></p>
</li>
<li>
<p>硬布线控制单元设计步骤</p>
<p><strong>步骤一:</strong>  列出微操作命令时间表</p>
<p>以下是 CLR， COM， SHR 等10条机器指令微操作命令的时间表，观察表结构，共有<strong>工作周期标记</strong>、<strong>节拍</strong>、<strong>状态条件</strong>、<strong>微操作命令信号</strong>、<strong>微操作命令</strong>表项，其中一个工作周期可能包含多个节拍， 其中一个节拍内可以完成多个<strong>独立的微操作命令（不独立的命令会造成冲突）</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://xuaii.github.io/post-images/1662435646503.JPG"
        data-srcset="https://xuaii.github.io/post-images/1662435646503.JPG, https://xuaii.github.io/post-images/1662435646503.JPG 1.5x, https://xuaii.github.io/post-images/1662435646503.JPG 2x"
        data-sizes="auto"
        alt="https://xuaii.github.io/post-images/1662435646503.JPG"
        title="https://xuaii.github.io/post-images/1662435646503.JPG" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://xuaii.github.io/post-images/1662435655639.JPG"
        data-srcset="https://xuaii.github.io/post-images/1662435655639.JPG, https://xuaii.github.io/post-images/1662435655639.JPG 1.5x, https://xuaii.github.io/post-images/1662435655639.JPG 2x"
        data-sizes="auto"
        alt="https://xuaii.github.io/post-images/1662435655639.JPG"
        title="https://xuaii.github.io/post-images/1662435655639.JPG" /></p>
<p><strong>步骤二:</strong>  微操作信号综合</p>
<p>$$
微操作控制信号 = 机器周期 \land 节拍 \land 脉冲 \land 操作码 \land 机器状态条件
$$</p>
<p>根据表构造逻辑表达式，然后经过化简整理得到可用现有门电路实现的微操作命令逻辑表达式：</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://xuaii.github.io/post-images/1662435665517.JPG"
        data-srcset="https://xuaii.github.io/post-images/1662435665517.JPG, https://xuaii.github.io/post-images/1662435665517.JPG 1.5x, https://xuaii.github.io/post-images/1662435665517.JPG 2x"
        data-sizes="auto"
        alt="https://xuaii.github.io/post-images/1662435665517.JPG"
        title="https://xuaii.github.io/post-images/1662435665517.JPG" /></p>
<p><strong>步骤三:</strong> 绘制微操作命令组合电路图（没什么技巧，就嗯画）</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://xuaii.github.io/post-images/1662435671505.JPG"
        data-srcset="https://xuaii.github.io/post-images/1662435671505.JPG, https://xuaii.github.io/post-images/1662435671505.JPG 1.5x, https://xuaii.github.io/post-images/1662435671505.JPG 2x"
        data-sizes="auto"
        alt="https://xuaii.github.io/post-images/1662435671505.JPG"
        title="https://xuaii.github.io/post-images/1662435671505.JPG" /></p>
</li>
</ol>
<h3 id="微程序控制器">微程序控制器</h3>
<p>在电路和机器指令之间添加了一层<strong>微程序</strong>，根据机器指令生成<strong>微指令序列</strong>（微程序），使用微程序来实现机器指令功能，而微程序是存储在 <strong>控制存储器（CM in CPU）</strong> 中的指令序列，优点是<strong>规整</strong>、<strong>灵活</strong>、<strong>可维护</strong>，缺点是每次都要从 <strong>CM</strong> 中取微指令，<strong>速度慢</strong></p>
<ol>
<li>
<p>微程序控制<strong>基本概念</strong></p>
<p>就是把微操作信号 <strong>代码化</strong>， 使每条机器指令转化为一段微程序存入<strong>控制存储器</strong>中（CM），微程序包含若干微指令，每条微指令对应1/n个微操作。</p>
<p><strong>微命令 &amp; 微操作</strong> ： 机器指令 -&gt; 微操作序列，在微程序控制计算机中，将控制部件向执行部件发送的<strong>控制命令</strong>称为<strong>微命令</strong>，例如：打开或关闭某个门电位信号，微操作是微命令的执行过程。</p>
<p>注意微命令的 <strong>相容</strong> 和 <strong>相斥</strong></p>
<p><strong>微指令 &amp; 微周期</strong>：微指令是若干微命令的集合（命令就是一位，指令就是一行），存放为微指令的控制存储器单元地址成为<strong>微地址</strong>，微指令包含两部分信息：</p>
</li>
</ol>
<ul>
<li>
<p>操作控制字段：控制信号</p>
</li>
<li>
<p>顺序控制字段：下一条微指令地址</p>
<p>微周期是指读取并执行一条微指令花费的时间</p>
<p><strong>主存储器 &amp; 控制存储器</strong>：主存是在 CPU 外部的RAM， 控制存储器是在 CPU 内部的ROM</p>
<p><strong>程序 &amp; 微程序</strong>： 微程序是机器指令的实时<strong>解释器</strong>，是在CPU 制造时预先设计和存储的，对程序员透明的</p>
<p><strong>相关寄存器</strong>：<strong>地址寄存器(MAR)</strong>， <strong>微地址寄存器(CMAR)</strong>，<strong>指令寄存器(IR)</strong>，<strong>微指令寄存器(CMDR / $\mu$IR)</strong></p>
</li>
</ul>
<ol start="2">
<li>
<p>微程序控制器<strong>组成</strong>和<strong>工作过程</strong></p>
<p><strong>组成</strong></p>
<p>控制存储器，微指令寄存器，微地址形成部件（产生最初地址和后继地址），微地址寄存器</p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://xuaii.github.io/post-images/1662435681568.png"
        data-srcset="https://xuaii.github.io/post-images/1662435681568.png, https://xuaii.github.io/post-images/1662435681568.png 1.5x, https://xuaii.github.io/post-images/1662435681568.png 2x"
        data-sizes="auto"
        alt="https://xuaii.github.io/post-images/1662435681568.png"
        title="https://xuaii.github.io/post-images/1662435681568.png" /></p>
<p><strong>工作过程</strong></p>
<p>取微指令公共操作 <strong>==&gt;</strong> 机器开始时，自动将取指微程序入口地址送入 CMAR，并取址；一般时 CM 的 0号地址，该微程序完成后 主存中取出的机器指令就存储在 IR 中</p>
<p>IR 操作码 ==&gt; 微地址形成部件 ==&gt; 微程序入口地址 ==&gt; CMAR</p>
<p>从CM 中逐条取出指令并执行，执行完一段微程序后回到<strong>取址微程序入口</strong>，周而复始</p>
</li>
<li>
<p>微指令的<strong>编码方式</strong></p>
<p><strong>直接编码</strong> ： 无需译码，每一位表示一个微命令，简单直观快速，并行性好，缺点是控制存储器容量变大</p>
<p><strong>字段直接编码</strong>：将微指令的微命令分成若干<strong>小段</strong>，把互斥性微命令组合在同一字段，把相容性微命令组合在不同字段，每个字段独立编码，各个字段编码单独定义，互不干扰</p>
<p>优点：缩短字长</p>
<p>缺点：通过译码电路减速</p>
<p>分段原则</p>
<ul>
<li>
<p>互斥命令同段，相容命令不同段</p>
</li>
<li>
<p>每个段信息为不能太多</p>
</li>
<li>
<p>每个小段留出一个状态表示无命令（000），因此状态数 = $2^N - 1$</p>
</li>
</ul>
<p><strong>字段间接编码</strong>：一个字段某些命令需要由另一些字段来解释，进一步减小了字长，削弱了并行能力，通常作为辅助手段</p>
</li>
<li>
<p>微指令的<strong>地址形成方式</strong></p>
<p>有两种基本类型</p>
<ul>
<li>
<p>直接由微指令的下地址字段指出（断定方式）</p>
</li>
<li>
<p>根据机器指令的操作码形成，通过微地址形成部件形成</p>
</li>
</ul>
<p>几种额外类型：</p>
<ul>
<li>
<p>增量计数 (CMAR) + 1 -&gt; CMAR, 连续存放</p>
</li>
<li>
<p>根据标志位决定微指令分支转移地址</p>
</li>
<li>
<p>通过测试网络形成</p>
</li>
<li>
<p>由硬件直接产生微程序入口地址</p>
</li>
</ul>
<p>加电后第一条微指令地址可以由专门的硬件电路产生</p>
</li>
<li>
<p>微指令的<strong>格式</strong></p>
<ul>
<li>
<p>水平型微指令： 指令中一位对应一个控制信号，优点：程序短，执行速度快；缺点：微指令长，编写微程序麻烦</p>
</li>
<li>
<p>垂直型微指令：采用类似机器指令的 操作数 | 操作码 | 操作码 的结构，优点：微指令短，简单，规整，便于编写；缺点是微程序长执行速度慢</p>
</li>
<li>
<p>混合型微指令：在垂直型的基础上增加一些不太复杂的并行操作，性能折中</p>
</li>
</ul>
</li>
<li>
<p>微程序<strong>控制单元</strong>的<strong>设计步骤</strong></p>
<p><strong>写出微操作命令的节拍安排</strong> 这里与之前的微操作表的区别是：</p>
<ul>
<li>
<p>取指阶段需要将 IR的操作码送往微地址形成部件, OP(IR) -&gt; CMAR</p>
</li>
<li>
<p>每条微指令执行完成后都需要形成后继微指令 , 微地址形成部件 -&gt; CMAR</p>
</li>
</ul>
<p><strong>确定微指令格式</strong> 微指令编码方式，后继指令形成方式，微指令字长</p>
<p>一般根据微操作个数决定编码方式，确定微指令操作控制字段位数，</p>
<p>由微指令数决定微指令顺序控制字段位数</p>
<p>按操作控制字段位数和顺序控制字段位数决定微指令字长</p>
</li>
<li>
<p><strong>动态微程序设计</strong>和<strong>毫微程序设计</strong></p>
<p>动态微程序就是可以更改的微程序，一般使用 EPROM，豪微程序试就是在微程序和电路之间再增加一层解释程序</p>
</li>
</ol>
<h2 id="异常和中断机制">异常和中断机制</h2>
<h3 id="概念">概念</h3>
<p><strong>异常</strong> 是 CPU 内部产生的意外事件，被称为内中断，是内部检测，与执行的指令相关的同步事件</p>
<p><strong>中断</strong> 是 CPU 发出的中断请求，被称为外中断，由外部设备触发，与当前执行指令无关</p>
<p>描述如下：</p>
<p>CPU 在执行用户程序<strong>第 i 条指令是检测到异常事件</strong> 或 <strong>第 i 条指令后发现一个中断请求信号</strong>，则 CPU 打断当前用户程序，然后转到相应的<strong>异常或中断处理程序</strong>去执行。</p>
<ul>
<li>
<p>若异常或中断处理程序能解决相应问题，则在处理程序的最后 CPU 指向异常或中断返回指令，回到被打断的用户程序第 i 条指令或 第 i + 1 条指令继续执行</p>
</li>
<li>
<p>若异常或中断处理程序发现是不可恢复的致命错误，则终止用户程序</p>
</li>
</ul>
<p>一般来说，对终端和异常的具体处理由操作系统（和驱动程序）完成</p>
<h3 id="分类">分类</h3>
<p><strong>异常的分类</strong></p>
<ol>
<li>
<p>故障（Fault）：在故障指令启动后，指令结束前被检查到的异常事件，例如：<em>译码时出现非法操作码</em>；<em>取数据时发生缺页缺段</em>；<em>除数为0</em>；其中有的能通过磁盘调入主存来解决，像除数为0这样的异常不能解决并回到原断点继续执行，必须终止进程的执行</p>
</li>
<li>
<p>自陷（Trap）：是<strong>预先安排</strong>的一种异常，事先在程序中用一条特殊的指令或通过特殊标志的设定来人为造成陷阱，执行到被设置了陷阱的指令时，CPU 在执行完自陷指令后，自动根据不同陷阱进行相应处理，然后返回自陷指令的下一条执行。</p>
<p>特别的，如果当前指令是转移指令，那不会返回到下一条指令继续执行，而是返回到目标指令继续执行</p>
<p>例如：<strong>程序断点调试</strong>， <strong>系统调用指令</strong>，<strong>条件自陷指令</strong>都属于陷阱指令，执行到这些指令时，无条件的或有条件的<strong>自动调出操作系统内核程序</strong>进行执行</p>
<p><strong>故障异常</strong>和<strong>自陷异常</strong>属于<strong>程序性异常</strong></p>
</li>
<li>
<p>终止（Abort）：指令执行过程中发生了使计算机无法继续执行的硬件故障，如<strong>控制器出错</strong>，<strong>存储器校验错误</strong>等，程序无法继续执行，只能终止，此时调出中断服务程序来重启系统，这种异常和故障<strong>不由特定指令造成</strong>，而是<strong>随机发生</strong>的，属于硬件异常</p>
</li>
</ol>
<p><strong>中断的分类</strong></p>
<ol>
<li>
<p>可屏蔽中断：通过<strong>可屏蔽中断请求线INTR</strong>  向 CPU 发送的中断请求，CPU可通过在中断控制器中设置相应的屏蔽字来屏蔽或不屏蔽它，被屏蔽的中断请求不会送到 CPU</p>
</li>
<li>
<p>不可屏蔽中断：通过专门的 <strong>不可屏蔽中断请求线NMI</strong> 向 CPU 发出中断请求，通常是紧急的硬件故障，如电源掉电</p>
</li>
</ol>
<h3 id="响应">响应</h3>
<p>过程为 ： 关中断 -&gt; 保存断点和程序状态 -&gt; 识别异常和中断并转移到相应的处理程序</p>
<ul>
<li>
<p>**<strong>关中断</strong></p>
<p>在保存断点和程序状态期间不能被新的中断打断，通过设置<strong>中断允许(IF)触发器</strong> 来实现禁止响应新的中断：</p>
</li>
<li>
<p>IF == 1 开中断，允许响应中断</p>
</li>
<li>
<p>IF == 0 关中断，不允许响应中断</p>
</li>
<li>
<p><strong>保存断点和程序状态</strong></p>
</li>
</ul>
<p>将程序断点（返回地址）送到栈或特定寄存器，通常保存在栈中（为了支持<strong>异常或中断的嵌套</strong>），状态字寄存器 PSWR 也需要保存到栈或者特定寄存器中。</p>
<ul>
<li><strong>识别异常和中断并转移到相应处理程序</strong></li>
</ul>
<p>异常大多数采用软件识别，中断由硬件识别和软件识别两种方式</p>
<p><strong>软件识别</strong>是 CPU 设置一个异常状态寄存器，用于记录异常原因。操作系统使用一个统一的异常或终端查询程序，按优先级查询异常状态寄存器，以检查中断或异常的类型，先查询到的先处理，然后转到内核中相应处理程序</p>
<p><strong>硬件识别</strong>也就是<strong>向量中断</strong>，异常或中断程序的首地址称为<strong>中断向量</strong>，所有中断向量存放在<strong>中断向量表</strong>中，每个异常或中断都被指定一个<strong>中断类型号</strong>，在中断向量表中类型号和中断向量一一对应，因为可以根据类型号快速找到对应的处理程序。</p>
<p>中断或异常的响应是<strong>不可被打断</strong>的。中断响应结束后 CPU 就从 PC 中取出中断服务程序的第一条指令开始执行，直到中断返回，整个过程是由软硬件协同完成的</p>
<h2 id="指令流水线">*指令流水线</h2>
<h3 id="1-基本概念">1. 基本概念</h3>
<p>MIPS 指令流水将指令分成以下五个阶段，每一个时钟到来就会有一条指令进入流水</p>
<ul>
<li>
<p>取指(IF) 从存储器/Cache中取指令（PC，指令寄存器，下一条指令地址计算逻辑）</p>
</li>
<li>
<p>译码(ID) 对指令进行译码，（操作控制器，去操作数逻辑，立即数符号扩展）</p>
</li>
<li>
<p>执行(EX) 执行运算/计算地址，（ALU，分支地址计算模块）</p>
</li>
<li>
<p>访存(MEM) 访问存储器，（数据存储器读写模块）</p>
</li>
<li>
<p>写回(WB) 将计算结果写回寄存器堆， （寄存器写入控制模块）</p>
</li>
</ul>
<p>区分阶段的企图是，划分 CPU 运行过程中的阶段，分析他们的关联性方便<strong>同时多条指令在不同部件上</strong>运行</p>
<p>流水原则：流水阶段个数以最复杂指令所用的功能段个数为准，流水长度以最耗时操作花费时间为准</p>
<p>便于流水的<strong>指令集特征</strong>：</p>
<ul>
<li>
<p>指令长度尽量一致，简化取指，译码</p>
</li>
<li>
<p>指令格式尽量规整，比如第几位是寄存器编号，第几位是地址，这样方便指令未知时直接通过<strong>位数</strong>取操作数</p>
</li>
<li>
<p>采用 Load / Store 指令，这样可以包访存指令的地址计算和运算指令的执行步骤规整在同一周期（不懂什么意思）</p>
</li>
<li>
<p>数据和指令对齐存放，减少访存次数</p>
</li>
</ul>
<p><strong>大量连续任务</strong>才能提高流水效率，流水<strong>延长单个指令</strong>执行时间，<strong>缩短整体</strong>执行时间</p>
<p><em>Tips:流水线需要多个锁存器来存储上一流水阶段的计算结果，控制信号，等来进行下一阶段计算</em></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://xuaii.github.io/post-images/1662522792155.JPG"
        data-srcset="https://xuaii.github.io/post-images/1662522792155.JPG, https://xuaii.github.io/post-images/1662522792155.JPG 1.5x, https://xuaii.github.io/post-images/1662522792155.JPG 2x"
        data-sizes="auto"
        alt="https://xuaii.github.io/post-images/1662522792155.JPG"
        title="https://xuaii.github.io/post-images/1662522792155.JPG" /></p>
<h3 id="2-流水线冒险">2. 流水线冒险</h3>
<p><strong>结构冒险</strong> 多条指令同时访问同一资源（例如：存储器，取指和访存都要访问）</p>
<p>解决：</p>
<ul>
<li>
<p>访存时流水暂停</p>
</li>
<li>
<p>区分数据存储器 和 指令存储器（事实上 L1 cache 就是这样区分的）</p>
</li>
</ul>
<p><strong>数据冒险</strong></p>
<p>分为 <em>写后读</em>、 <em>读后写</em>、 <em>写后写</em> 三种</p>
<p>解决：</p>
<ul>
<li>
<p>流水暂停(stall，硬件实现), NOP空指令(编译器实现)</p>
</li>
<li>
<p>数据旁路技术（数据前推）</p>
</li>
<li>
<p>编译优化调整指令顺序</p>
</li>
</ul>
<p><strong>控制冒险</strong></p>
<p><em>指令跳转</em>、<em>调用过程</em>、<em>返回</em>等会改变 PC 寄存器值的指令，会导致<strong>控制冒险</strong></p>
<p>以前采用延迟槽方法（即在跳转指令后插入无论如何都要执行的指令），现代 CPU 都使用<strong>分支预测</strong>的方法，预测成功什么都不会发生，预测失败就<strong>清空流水线</strong></p>
<p>解决：</p>
<ul>
<li>
<p>分支预测 （分为动态和静态预测）</p>
</li>
<li>
<p>预取转移成功和不成功两个方向的指令</p>
</li>
<li>
<p>加快提前形成条件码</p>
</li>
<li>
<p>提高转移方向的<strong>猜准率</strong></p>
</li>
</ul>
<h3 id="3-性能指标">3. 性能指标</h3>
<p><strong>流水线吞吐率(TP)</strong></p>
<p>$$
TP = \frac{n}{T_k} = \frac{n}{(k+n-1)<em>\Delta t}\
TP_{max} = \lim\limits_{n\rightarrow\infty}\frac{n}{(k+n-1)</em>\Delta t} = \frac{1}{\Delta t}
$$</p>
<p><strong>流水线加速比(S)</strong></p>
<p>$$
S = \frac{T_0}{T_k} = \frac{kn\Delta t}{(k+n-1)<em>\Delta t}\
S_{max} = \lim\limits_{n\rightarrow\infty}\frac{kn\Delta t}{(k+n-1)</em>\Delta t} = k
$$</p>
<p>其中，n 是指令数量， k 是流水阶段数， $\Delta t$ 是时钟周期</p>
<h3 id="4-高级流水线技术">4. 高级流水线技术</h3>
<p>处理机一次发射多条指令的<strong>多发射技术</strong>，增加流水线级数的<strong>超流水线技术</strong></p>
<p>超标量流水线技术：不能调整指令执行顺序，并行执行指令搭配</p>
<p>超长指令字技术：也称静态多发射技术，编译程序挖掘程序潜在并行性，将多条能并行的指令组合成一条具有多个操作码的指令（几百位），需要多个部件处理</p>
<p>超流水线技术：增加级数，每级的操作量减小，纳闷呢时钟周期就可以减小，但是依然是一个周期进入一条指令，总的来讲效率提高</p>
<h2 id="多处理器基本概念">多处理器基本概念</h2>
<h3 id="sisdsimdmimd">SISD、SIMD、MIMD</h3>
<p><strong>SISD</strong> 是传统的串行计算机结构，包含一个处理器一个存储器，指令按规定顺序执行，SISD 为了提高效率采用流水的方式，之前的内容大都是 SISD 结构</p>
<p><strong>SIMD</strong> 是指一个指令同时对多个数据流进行处理，成为<strong>数据级并行技术</strong>，通常由<strong>一个指令控制部件</strong>、<strong>多个处理单元</strong>组成，每个单元执行同一条指令，但每个处理单元都有自己的地址寄存器，因此每个单元都有不同的数据地址，因此，<strong>不同处理单元在不同数据集上执行相同的指令</strong>。</p>
<p>一个应用程序被编译后可能按SISD在串行硬件上执行，也可能按SIMD 组织并运行于并行硬件上</p>
<p>SIMD 在使用 for 循环处理数组时最有效，例如：对16对数据进行运算的 SIMD 指令如果在16个ALU中同时运算，只需要一次运算时间就能完成。SIMD 在使用 case-switch 语句时效率最低，此时每个执行单元必须<strong>根据不同数据执行不同操作</strong>。</p>
<p><strong>MISD</strong> 是同时执行多条指令，处理同一个数据，实际上不存在这样的计算机</p>
<p><strong>MIMD</strong> 同时执行多条指令处理不同数据，分为<strong>多计算机系统</strong> 和 <strong>多处理器系统</strong></p>
<p>多计算机系统中每个计算机节点都具有各自私有的存储器，和独立的主存空间，不能相关通过存取指令访问。需要通过消息传递进行数据传送。</p>
<p>多处理器系统是<strong>共享多处理器系统SMP</strong>的简称，它共享单一地址空间，通过存取指令访问多有存储器</p>
<h3 id="硬件多线程">硬件多线程</h3>
<p>目的减小线程切换开销</p>
<ol>
<li>
<p>细粒度多线程</p>
<p>多个线程之间轮流交换执行指令，线程间指令不相关，可以乱序并行执行。处理器能在<strong>每个时钟周期</strong>切换线程</p>
</li>
<li>
<p>粗粒度多线程</p>
<p>在线程出现较大开销阻塞时切换线程，如 cache 缺失。这种情况下，当发生流水阻塞时，必须清除被阻塞的流水线，新的线程指令开始执行前需要重载流水线，因此开销很大</p>
</li>
<li>
<p>同时多线程（SMT）</p>
<p>是上述两种多线程技术的变体。在实现指令级并行的同时，实现线程级并行，也就是说，在一个时钟周期内，发射多个不同线程中的多条指令执行。Intel 中的<strong>超线程技术</strong>就是同时对线程，即在一个单处理器或单个核中设置两套线程状态部件，共享高速缓存和功能部件。</p>
</li>
</ol>
<h3 id="多核处理器">多核处理器</h3>
<p>多个处理单元集成到单个CPU，每个核可以有自己的 cache，也可以共享 cache，共享主存储器</p>
<h3 id="共享内存多处理器">共享内存多处理器</h3>
<p>通过存储器中的共享变量相互通信，可以在各个处理器自己的虚拟地址空间单独运行</p>
<ul>
<li>
<p>统一存储访问（UMA）多处理器：分为<strong>基于总线</strong>，<strong>基于交叉开关网络</strong>，<strong>基于多级交换网络</strong> 连接等几种处理器</p>
</li>
<li>
<p>非统一存储访问（NUMA）多处理器：处理器中不带高速缓存时被称为 NC-NUMA，带有一致性高速缓存时被称为 CC-NUMA</p>
</li>
</ul>
<p>最初内存控制器没有整合进 CPU， 需要通过北桥的内存控制器访问内存，这种架构随着 多核 CPU 的发展而达到瓶颈（争用前端总线），所以NUMA 架构诞生，每个 CPU 分配一个内存区域，而 CPU 之间通过 QPI 总线相连，CPU 通过 QPI 访问其他CPU的远程内存。</p>
<p>由于内存共享， 对于共享变量需要使用同步机制，例如对变量加锁 3</p>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-09-05</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/ji-suan-ji-zu-cheng-yuan-li-zhong-yang-chu-li-qi/index.md" target="_blank">Read Markdown</a>
                        </span></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="http://blog.xuaii.cc/ji-suan-ji-zu-cheng-yuan-li-zhong-yang-chu-li-qi/" data-title="计算机组成原理 中央处理器"><i class="fab fa-twitter fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="http://blog.xuaii.cc/ji-suan-ji-zu-cheng-yuan-li-zhong-yang-chu-li-qi/"><i class="fab fa-facebook-square fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Hacker News" data-sharer="hackernews" data-url="http://blog.xuaii.cc/ji-suan-ji-zu-cheng-yuan-li-zhong-yang-chu-li-qi/" data-title="计算机组成原理 中央处理器"><i class="fab fa-hacker-news fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on Line" data-sharer="line" data-url="http://blog.xuaii.cc/ji-suan-ji-zu-cheng-yuan-li-zhong-yang-chu-li-qi/" data-title="计算机组成原理 中央处理器"><i data-svg-src="/lib/simple-icons/icons/line.min.svg" aria-hidden="true"></i></a><a href="javascript:void(0);" title="Share on 微博" data-sharer="weibo" data-url="http://blog.xuaii.cc/ji-suan-ji-zu-cheng-yuan-li-zhong-yang-chu-li-qi/" data-title="计算机组成原理 中央处理器" data-ralateuid="5661205446"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/ji-suan-ji-zhi-ling-xi-tong/" class="prev" rel="prev" title="计算机指令系统"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>计算机指令系统</a>
            <a href="/neural-network/" class="next" rel="next" title="Neural Network">Neural Network<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.111.3">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2023</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="blog.xuii.cc" target="_blank">_quijo</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/sharer/sharer.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"cookieconsent":{"content":{"dismiss":"Got it!","link":"Learn more","message":"This website uses Cookies to improve your experience."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","maxResultLength":10,"noResultsFound":"No results found","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
